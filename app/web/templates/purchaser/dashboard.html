{% extends "includes/base.html" %}
{% block content %}
<h2>Purchaser Dashboard (Welcome, {{ user.username }})</h2>

<h3>Available Orders (Order Pool)</h3>
<table>
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Store</th>
            <th>Category</th>
            <th>Required Qty</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    {% for order in orders %}
        {% if order.status.value == 'PENDING_PURCHASE' %}
        <tr>
            <td>{{ order.order_id_str }}</td>
            <td>{{ order.store.username }}</td>
            <td>{{ order.category }}</td>
            <td>{{ order.quantity }}</td>
            <td>
                <form action="/accept-order/{{ order.id }}" method="post" class="inline-form">
                    <button type="submit" class="btn btn-success">Accept</button>
                </form>
            </td>
        </tr>
        {% endif %}
    {% endfor %}
    </tbody>
</table>

<h3 style="margin-top: 40px;">My Active Orders</h3>
<table>
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Store</th>
            <th>Category</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    {% for order in orders %}
        {% if order.purchaser_id == user.id %}
        <tr>
            <td>{{ order.order_id_str }}</td>
            <td>{{ order.store.username }}</td>
            <td>{{ order.category }}</td>
            <td>{{ order.status.value }}</td>
            <td>
                {% if order.status.value in ['PENDING_PURCHASE', 'REJECTED'] %}
                    <a href="/order/{{ order.id }}" class="btn btn-primary">Enter Buying Rate</a>
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
        {% endif %}
    {% endfor %}
    </tbody>
</table>
{% endblock %}